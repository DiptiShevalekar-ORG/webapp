name: CI for Image Build

on:
  pull_request:
    types: [closed]
    branches:
          - main

jobs:
  
    build:
        name: Image Build
        runs-on: ubuntu-latest
       
        steps:
             - name: Checkout Repository
               uses: actions/checkout@v2

             - name: Authenticate with GCP
               uses: google-github-actions/auth@v2
               with:
                       credentials_json: ${{ secrets.GCP_SA_KEY }}

             - name: Packer init for trial
               run: |
                 ls 
                 pwd
                 cd Dipti_Shevalekar_002245703_01/packer
                 packer init gcp.pkr.hcl
       
             - name: build packer
               run: |
                       cd Dipti_Shevalekar_002245703_01/packer
                       packer build gcp.pkr.hcl

